C51 COMPILER V9.50a   MAIN                                                                 11/30/2016 18:28:25 PAGE 1   


C51 COMPILER V9.50a, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*
   2          PWM
   3          16/11/30
   4          抛弃原来错误的方法
   5          采用定时器中断
   6          
   7          */
   8          #define uint unsigned int
   9          #define uchar unsigned char
  10          #include<reg52.h>
  11          #include<intrins.h>
  12          sbit led0=P1^0;
  13          sbit led1=P1^1;
  14          sbit led2=P1^2;
  15          sbit led3=P1^3;
  16          sbit led4=P1^4;
  17          sbit led5=P1^5;
  18          sbit led6=P1^6;
  19          sbit led7=P1^7;
  20          static count=0;
  21          
  22          void Timer0Init(void)           //20微秒@11.0592MHz
  23          {
  24   1              //AUXR |= 0x80;         //定时器时钟1T模式
  25   1              TMOD &= 0xF0;           //设置定时器模式
  26   1              TMOD |= 0x01;           //设置定时器模式
  27   1              TL0 = 0xFF;             //设置定时初值
  28   1              TH0 = 0xFF;             //设置定时初值
  29   1              TF0 = 0;                //清除TF0标志
  30   1              TR0 = 1;                //定时器0开始计时
  31   1      }
  32          void delay(uint sec){
  33   1              
  34   1              while(sec--);
  35   1      
  36   1      }
  37          
  38          
  39          void Delay200ms()               //@11.0592MHz
  40          {
  41   1              unsigned char i, j, k;
  42   1      
  43   1              _nop_();
  44   1              i = 2;
  45   1              j = 103;
  46   1              k = 147;
  47   1              do
  48   1              {
  49   2                      do
  50   2                      {
  51   3                              while (--k);
  52   3                      } while (--j);
  53   2              } while (--i);
  54   1      }
  55          void timer0() interrupt 1{
C51 COMPILER V9.50a   MAIN                                                                 11/30/2016 18:28:25 PAGE 2   

  56   1              
  57   1              //因为定时器在溢出后寄存器中的初值寄存器自动归零，
  58   1              //所以需要重新赋值才能有想要的延时      
  59   1              TL0 = 0xFF;             //设置定时初值
  60   1              TH0 = 0xFF;             //设置定时初值
  61   1                      count++;
  62   1              if (count==1 ){
  63   2                      led0=~led0;}
  64   1              if (count==10){
  65   2                      led0=~led0;
  66   2                      count=0;
  67   2              }
  68   1              
  69   1              
  70   1      }
  71          
  72          
  73          void main()
  74          {
  75   1              
  76   1              Timer0Init();
  77   1              //初始化定时器
  78   1              EA=1;
  79   1              //允许中中断
  80   1              ET0=1;
  81   1              //允许定时器中断
  82   1              led0=0;
  83   1              led1=0;
  84   1              while(1);
  85   1              
  86   1              
  87   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     96    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
