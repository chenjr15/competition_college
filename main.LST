C51 COMPILER V9.50a   MAIN                                                                 11/30/2016 21:54:01 PAGE 1   


C51 COMPILER V9.50a, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*
   2          PWM
   3          16/11/30
   4          抛弃原来错误的方法
   5          采用定时器中断
   6          */
   7          /*中断号 0,2为外部中断 1,3为定时器中断 4为串口中断 
   8          即：
   9          0       INT0
  10          1       T0
  11          2       INT1
  12          3       T1
  13          4       serial 
  14          
  15          TCON:D7-D0                      D3
  16                  TF1 TR1 TF0     TR0     IE1     IT1     IE0     IT0
  17          IE      :D7-D0                  
  18                  EA                      ES      ET1     EX1     ET0     EX0
  19          TMOD:D7-D0
  20                  GATE    C/T M1  M0|     GATE    C/T     M1      M0
  21                                  T1                |                     T0
  22          
  23          */
  24          #define uint unsigned int
  25          #define uchar unsigned char
  26          #include<reg52.h>
  27          #include<intrins.h>
  28          sbit led0=P1^0;
  29          sbit led1=P1^1;
  30          sbit led2=P1^2;
  31          sbit led3=P1^3;
  32          sbit led4=P1^4;
  33          sbit led5=P1^5;
  34          sbit led6=P1^6;
  35          sbit led7=P1^7;
  36          static count=0;
  37          static count_CB=0;
  38          static time_PWM=0;
  39          void Timer0Init(void)           //5微秒@11.0592MHz
  40          {
  41   1              //AUXR |= 0x80;         //定时器时钟1T模式
  42   1              TMOD &= 0xF0;           //设置定时器模式
  43   1              TMOD |= 0x01;           //设置定时器模式
  44   1              TL0 = 0xFB;             //设置定时初值
  45   1              TH0 = 0xFF;             //设置定时初值
  46   1              TF0 = 0;                //清除TF0标志
  47   1              TR0 = 1;                //定时器0开始计时
  48   1      }
  49          void delay(uint sec){
  50   1              
  51   1              while(sec--);
  52   1      
  53   1      }
  54          
  55          
C51 COMPILER V9.50a   MAIN                                                                 11/30/2016 21:54:01 PAGE 2   

  56          void Delay200ms()               //@11.0592MHz
  57          {
  58   1              unsigned char i, j, k;
  59   1      
  60   1              _nop_();
  61   1              i = 2;
  62   1              j = 103;
  63   1              k = 147;
  64   1              do
  65   1              {
  66   2                      do
  67   2                      {
  68   3                              while (--k);
  69   3                      } while (--j);
  70   2              } while (--i);
  71   1      }
  72          void timer0() interrupt 1{
  73   1              
  74   1              //因为定时器在溢出后寄存器中的初值寄存器自动归零，
  75   1              //所以需要重新赋值才能有想要的延时      
  76   1              TL0 = 0xFB;             //设置定时初值
  77   1              TH0 = 0xFF;             //设置定时初值
  78   1                      count++;
  79   1                      count_CB++;
  80   1              if (count==time_PWM ){
  81   2                      led0=~led0;}
  82   1              if (count==50){
  83   2                      led0=~led0;
  84   2                      count=0;}               
  85   1              if (time_PWM >= 49){
  86   2                      time_PWM=1;}
  87   1                      }
  88          
  89                          
  90          void KeyINT0() interrupt 0{
  91   1              
  92   1              time_PWM +=20;
  93   1              
  94   1              
  95   1              
  96   1      }
  97          
  98          void main()
  99          {
 100   1              
 101   1              Timer0Init();
 102   1              //初始化定时器
 103   1              EA=1;
 104   1              //允许中中断
 105   1              ET0=1;EX0=1;
 106   1              IT0=1;
 107   1              //允许定时器中断,外部中断
 108   1              led0=0;
 109   1              while(1);
 110   1              
 111   1              
 112   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    153    ----
   CONSTANT SIZE    =   ----    ----
C51 COMPILER V9.50a   MAIN                                                                 11/30/2016 21:54:01 PAGE 3   

   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
