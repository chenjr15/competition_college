C51 COMPILER V9.50a   MAIN                                                                 12/16/2016 10:09:27 PAGE 1   


C51 COMPILER V9.50a, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          
   2          /*PWM OK
   3          
   4          */
   5          /*中断号 0,2为外部中断 1,3为定时器中断 4为串口中断 
   6          即：
   7          0       INT0
   8          1       T0
   9          2       INT1
  10          3       T1
  11          4       serial 
  12          
  13          TCON:D7-D0                      D3
  14                  TF1 TR1 TF0     TR0     IE1     IT1     IE0     IT0
  15          IE      :D7-D0                  
  16                  EA                      ES      ET1     EX1     ET0     EX0
  17          TMOD:D7-D0
  18                  GATE    C/T M1  M0|     GATE    C/T     M1      M0
  19                                  T1                |                     T0
  20          
  21          */
  22          #include <reg52.h>
  23          #include <intrins.h>
  24          #include <math.h>
  25          #include "oled.h"
  26          #include "bmp.h"
  27          #include "mcu_contest.h"
  28          
  29          
  30          
  31          void main(){
  32   1              
  33   1              Timer0Init();
  34   1              //初始化定时器
  35   1              EA=1;
  36   1              //允许中断
  37   1              ET0=1;EX0=1;
  38   1              IT0=1;
  39   1              //允许定时器中断
  40   1          T2MOD = 0x02;                   //enable timer2 output clock
  41   1          RCAP2L = TL2 = F500KHz;        //initial timer2 low byte
  42   1          RCAP2H = TH2 = F500KHz >> 8;   //initial timer2 high byte
  43   1          TR2 = 1;                        //timer2 start running
  44   1              //EA=1;
  45   1              OLED_Init();                    //初始化OLED  
  46   1              OLED_Clear(); 
  47   1              //TimeInit();
  48   1              peoplein=0;
  49   1              while(1){
  50   2              /*
  51   2              1.扫描按键　（亮度／模式／色温）
  52   2              2.判断模式，自动或手动
  53   2              若自动：
  54   2                      读取红外传感器的值
  55   2                              若为0 设置PWM亮度（占空比）为1
C51 COMPILER V9.50a   MAIN                                                                 12/16/2016 10:09:27 PAGE 2   

  56   2                              若为1 读取亮度传感器的值，并设置相应占空比
  57   2              若手动;
  58   2                      设置亮度往传感器对应值接近两个单位  正常亮度时光敏电阻传感器大概为2.5-2.
             -7K
  59   2              3.读取温度湿度
  60   2              4.读取时间
  61   2              5.刷新OLED屏 时间，日期，温度/湿度，亮度，自动/手动
  62   2              
  63   2              调整时间未完成
  64   2              PWM将在定时器中断中完成
  65   2              
  66   2              
  67   2              */
  68   2                      //1.key
  69   2                      scankey();
  70   2                      brightness1=(UCHAR)brightness*(color*0.2);
  71   2                      brightness2=brightness-brightness1;
  72   2                      
  73   2                      ReadTemperature();
  74   2                      //showtime();
  75   2                      switch(mode){
  76   3                              case 0: //手动
  77   3                              lighton=1;
  78   3                                      break;
  79   3                              case 1://自动
  80   3                                      if(!peoplein) {
  81   4                                              lighton=0;
  82   4                                      }else{
  83   4                                              lighton=1;
  84   4                                              ADC();
  85   4                                              if ((brightness>brightness_auto)&&(brightness_auto<=15)) brightness+=2;
  86   4                                              if ((brightness<brightness_auto)&&(brightness_auto>=0)) brightness-=2;  
  87   4                                      }
  88   3                                      break;}
  89   2                                      //debug
  90   2                                      
  91   2                                      OLED_ShowChar(4,0,mode+'0',16);
  92   2                                      OLED_ShowChar(20,0,color+'0',16);
  93   2                                      OLED_ShowNum(36,0,brightness,2,16);
  94   2                                      OLED_ShowNum(58,0,brightness1,2,16);
  95   2                                      OLED_ShowNum(90,0,brightness2,2,16);
  96   2                                      OLED_ShowNum(0,2,V,3,16);
  97   2                                      OLED_ShowNum(58,2,count,1,16);
  98   2                                      OLED_ShowNum(90,2,peoplein,1,16);
  99   2                                      OLED_ShowNum(106,2,lighton,2,16);
 100   2                                      OLED_ShowNum(0,4,I_1*100+I_0*10+F_1,3,16);
 101   2                                      }}


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    973    ----
   CONSTANT SIZE    =    144    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     32    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
